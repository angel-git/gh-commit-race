name: 'publish'
on:
  release:
    types: [created]

jobs:
  publish-windows:
    permissions:
      contents: write

    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: install Rust stable
        uses: dtolnay/rust-toolchain@stable
      - name: Build Portable Binaries (Windows)
        run: |
          cargo build --release
          mv ./target/release/gh-commit-race.exe ./target/release/gh-commit-race${{ github.event.release.tag_name }}_x64.exe
      - name: Upload Portable Binaries (Windows)
        run: bash -c 'gh release upload ${{ github.event.release.tag_name }} ./target/release/gh-commit-race${{ github.event.release.tag_name }}_x64.exe --clobber'
